import { AfterViewInit, Component, OnInit } from "@angular/core";
import { AdminDashboardService } from "../services/admin-dashboard.service";
import { AuthService } from '../../shared/services/auth.service';
import moment = require('moment');

declare var $:any;

@Component({
  selector: "app-members-admin",
  templateUrl: "./members-admin.component.html",
  styleUrls: ["./members-admin.component.css"]
})
export class MembersAdminComponent implements OnInit, AfterViewInit {
  private headerRow = ["Name", "Email", "Is Subscribed", "Created On", "Last Subscription", "Actions"];
  private footerRow = this.headerRow;
  private allMembers;

  constructor(private authService: AuthService, private adminDashboardService: AdminDashboardService) {}

  ngOnInit() {
    this.adminDashboardService.getMembers().subscribe(
      members => {
        console.log("Members => ", members);

        this.allMembers = members.data.map(member => {
          const created_at = moment(member.created_at).format("MMM D, YYYY");

          return {
            name: member.first_name + " " + member.last_name,
            email: member.email,
            isSubscribe: member.is_subscribe,
            createdAt: created_at,
            subscriptionEnd: "Last Subscription",
            action: "btn-round"
          };
        });
      },
      error => {
        // this.router.navigate(["/login"]);
        console.log(error);
        this.authService.logout();
      }
    );
  }

  ngAfterViewInit(){

    $("#datatables").DataTable({
      "pagingType": "full_numbers",
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      responsive: true,
      language: {
      search: "_INPUT_",
        searchPlaceholder: "Search records",
      }
    });

    var table = $("#datatables").DataTable();
     // Edit record
    table.on( "click", ".edit", function () {
      var $tr = $(this).closest("tr");

      var data = table.row($tr).data();
      alert( "You press on Row: " + data[0] + " " + data[1] + " " + data[2] + "\"s row." );
    });

    // Delete a record
    table.on( "click", ".remove", function (e) {
      var $tr = $(this).closest("tr");
      table.row($tr).remove().draw();
      e.preventDefault();
    });

    //Like record
    table.on( "click", ".like", function () {
      alert("You clicked on Like button");
    });
  }

}
